<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    .a-enter-vr {
      display: none !important;
    }
    /* Add a basic fade-out for the loading screen for a smoother transition */F
    #loading-screen.hidden,
    #welcome-message.hidden,
    #help-modal.hidden { /* Apply hidden class to all overlays */
      opacity: 0;
      transition: opacity 4s ease-out; /* CORRECTED to 4 seconds for fade */
    }

    /* Styling for the welcome message content */
    #welcome-message {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-size: 24px; /* Larger for a welcome message */
      font-family: sans-serif;
      color: white;
      background: rgba(0, 0, 0, 0.9); /* More opaque for focus */
      z-index: 1000; /* Higher z-index to be on top */
      /* Removed text-align: center from here */
    }

    #welcome-message h1 { /* Added H1 for the main welcome text */
        font-size: 2em; /* Adjust as needed */
        margin-bottom: 20px;
        text-align: center; /* Keep the main welcome text centered */
    }

    #welcome-message .instructions,
    #welcome-message .note { /* Applied left-align to both instruction paragraphs */
      font-size: 16px;
      margin-top: 10px; /* Adjusted margin slightly */
      line-height: 1.5;
      max-width: 80%; /* Limit width for better readability on large screens */
      text-align: left; /* Aligned to the left */
    }

    #welcome-message .note {
        font-style: italic;
        font-size: 0.9em;
        margin-top: 20px; /* More space above the note */
    }


    /* Styling for the help modal */
    #help-modal {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      font-family: sans-serif;
      color: white;
      background: rgba(0, 0, 0, 0.9); /* Opaque background for modal */
      z-index: 1001; /* Higher than welcome-message and loading-screen */
      text-align: center; /* This centers the modal content block, but not text within it */
      /* Start hidden */
      opacity: 0;
      pointer-events: none; /* Allows clicks to pass through when hidden */
    }

    #help-modal.visible {
        opacity: 1;
        pointer-events: auto; /* Enable clicks when visible */
        transition: opacity 0.3s ease-in-out;
    }

    #help-modal-content {
        background: rgba(255, 255, 255, 0.1); /* Slightly visible content background */
        padding: 30px;
        border-radius: 10px;
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto; /* Enable scrolling for long content */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        text-align: left; /* Explicitly align text within modal content to the left */
    }

    #help-modal-content h2 {
        margin-top: 0;
        font-size: 24px;
        color: #fff;
        text-align: center; /* Keep modal title centered */
    }

    #help-modal-content p {
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 15px;
    }

    #help-modal-content ul {
        list-style-type: none; /* Remove default bullets */
        padding: 0;
        margin: 0 0 20px 0;
    }

    #help-modal-content ul li {
        margin-bottom: 10px;
        padding-left: 20px; /* Indent list items */
        position: relative;
    }

    #help-modal-content ul li::before {
        content: '➡️'; /* Custom bullet point */
        position: absolute;
        left: 0;
        color: #007bff; /* Highlight color for bullet */
    }

    #close-help-button {
      margin-top: 25px;
      padding: 10px 25px;
      font-size: 16px;
      background-color: #007bff; /* Blue button */
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    #close-help-button:hover {
        background-color: #0056b3; /* Darker blue on hover */
    }

    /* Style for the help button (icon) */
    #help-button {
        position: absolute;
        top: 20px;
        right: 120px; /* Adjusted to the left of "Inquiry" button */
        width: 40px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        font-weight: bold;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%; /* Makes it a circle */
        cursor: pointer;
        z-index: 999; /* Same as other UI buttons */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: background-color 0.2s ease-in-out;
    }
    #help-button:hover {
        background-color: rgba(0, 0, 0, 0.9);
    }
  </style>
</head>
<body style="margin: 0; overflow: hidden;">

  <div id="welcome-message">
    <h1>Qrcky's AR Exhibition</h1>
    <p class="instructions">
      <strong>Quick Start</strong><br>
      1. Scan the QR code.<br>
      2. Allow camera access if prompted.<br>
      3. Aim your device at the QR code and background marker.<br>
      4. Tap the <strong>'i'</strong> button for details.
    </p>
  </div>

  <div id="loading-screen" style="
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    font-family: sans-serif;
    color: white;
    background: rgba(0, 0, 0, 0.6);
    padding: 10px 20px;
    border-radius: 8px;
    z-index: 999; /* Lower than welcome-message */
    text-align: center;">
    Loading AR experience...<br>Please be mindful of your surroundings
  </div>

  <div style="position: absolute; top: 20px; left: 20px; z-index: 999;">
    <a href="https://www.instagram.com/qrcky/" target="_blank">
      <img src="./insta.png" alt="Instagram" style="height: 28px; opacity: 0.8; cursor: pointer;" />
    </a>
  </div>

  <button id="help-button">i</button>

  <button onclick="window.open('https://www.qrcky.net/originals-paintings-black-and-white-art', '_blank')"
    style="position: absolute; top: 20px; right: 20px; padding: 6px 14px; font-size: 14px; background-color: rgba(0, 0, 0, 0.8); color: white; border: none; border-radius: 6px; cursor: pointer; z-index: 999; height: 40px;">
    Inquiry
  </button>

  <div id="help-modal">
    <div id="help-modal-content">
        <h2>How to Use This AR Experience</h2>
        <p>Follow these simple steps to explore the exhibition:</p>
        <ul>
            <li>Point your device's camera at one of the designated artwork markers.</li>
            <li>Once detected, the art will come to life as a 3D model!</li>
            <li>Move your device around the marker to view the model from different angles.</li>
            <li>Walk closer or further away to zoom in or out.</li>
            <li>Ensure good lighting and avoid reflections on the markers for best tracking.</li>
            <li>If the model disappears, simply re-point your camera at the marker.</li>
            <li>For more details or to make an inquiry about the art, tap the 'Inquiry' button.</li>
        </ul>
        <button id="close-help-button">Got It!</button>
    </div>
  </div>


  <a-scene mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 1; filterMinCF: 0.001; filterBeta: 0.05; missTolerance: 10; warmupTolerance: 10"
            color-space="sRGB"
            renderer="precision: medium; antialias: false; colorManagement: true; physicallyCorrectLights: true"
            vr-mode-ui="enabled: false"
            device-orientation-permission-ui="enabled: false">

    <a-assets>
      <a-asset-item id="mayaModel" src="./maya.glb"></a-asset-item>
      <a-asset-item id="regretModel" src="./miss_regret.glb"></a-asset-item>
      <a-asset-item id="seedlessFruitModel" src="./seedless-fruit.glb"></a-asset-item>
      <a-asset-item id="mapisModel" src="./mapis.glb"></a-asset-item>
      <a-asset-item id="negusAnewModel" src="./negus-anew.glb"></a-asset-item>
      <a-asset-item id="ebonyModel" src="./ebony.glb"></a-asset-item>
      <a-asset-item id="model6" src="./living-in-america.glb"></a-asset-item>
      <a-asset-item id="model7" src="./loys.glb"></a-asset-item>
      <a-asset-item id="model8" src="./base.glb"></a-asset-item>
      <a-asset-item id="model9" src="./maps.glb"></a-asset-item>
      <a-asset-item id="model10" src="./miss_regret.glb"></a-asset-item>
      <a-asset-item id="model11" src="./porcelainv3.glb"></a-asset-item>
      <a-asset-item id="model12" src="./sdwtbs.glb"></a-asset-item>
      <a-asset-item id="model13" src="./transcending-myself.glb"></a-asset-item>
      <a-asset-item id="model14" src="./twins.glb"></a-asset-item>

      <audio id="museum-audio" src="./museum_sounds.mp3" preload="auto"></audio>
    </a-assets>

    <a-entity sound="src: #museum-audio; loop: true; autoplay: true; volume: 0.5"></a-entity>


    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity light="type: ambient; intensity: 2.0; color: #ffffff"></a-entity>
    <a-entity light="type: directional; intensity: 0.1; color: #ffffff; castShadow: true" position="1 1 1"></a-entity>
    <a-entity light="type: directional; intensity: 0.5; color: #ffffff" position="-1 1 1"></a-entity>

    <a-entity mindar-image-target="targetIndex: 0">
      <a-gltf-model src="#mayaModel" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 1">
      <a-gltf-model src="#regretModel" position="0 0 -0.3" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 2">
      <a-gltf-model src="#seedlessFruitModel" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 3">
      <a-gltf-model src="#mapisModel" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 4">
      <a-gltf-model src="#negusAnewModel" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 5">
      <a-gltf-model src="#ebonyModel" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 6">
      <a-gltf-model src="#model6" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 7">
      <a-gltf-model src="#model7" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 8">
      <a-gltf-model src="#model8" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 9">
      <a-gltf-model src="#model9" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 10">
      <a-gltf-model src="#model10" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 11">
      <a-gltf-model src="#model11" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 12">
      <a-gltf-model src="#model12" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 13">
      <a-gltf-model src="#model13" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

    <a-entity mindar-image-target="targetIndex: 14">
      <a-gltf-model src="#model14" position="0 0 0" scale="0.2 0.2 0.2" animation-mixer></a-gltf-model>
    </a-entity>

  </a-scene>

  <script>
    // The 'enhanced-tracking' component definition has been removed.

    const sceneEl = document.querySelector('a-scene');
    const loadingScreen = document.getElementById('loading-screen');
    const welcomeMessage = document.getElementById('welcome-message');
    const helpButton = document.getElementById('help-button');
    const helpModal = document.getElementById('help-modal');
    const closeHelpButton = document.getElementById('close-help-button');
    // Get a reference to the audio element - UPDATED ID
    const museumAudioElement = document.getElementById('museum-audio');


    // Function to hide a given element with fade-out
    const hideElement = (element) => {
      if (element.classList.contains('hidden') || element.style.display === 'none') {
        return;
      }
      element.classList.add('hidden');
      element.addEventListener('transitionend', () => {
        element.style.display = 'none';
      }, { once: true });
      console.log(`${element.id} hidden.`);
    };

    // Function to show a given element (for modals)
    const showElement = (element) => {
        element.style.display = 'flex'; // Use flex to center content
        // Force reflow to ensure display change applies before opacity transition
        element.offsetWidth;
        element.classList.remove('hidden');
        element.classList.add('visible'); // For modal specific visibility class
        console.log(`${element.id} shown.`);
    }

    // Hide the welcome message after 2.5 seconds (then it takes 4 seconds to fade)
    setTimeout(() => {
      hideElement(welcomeMessage);
    }, 2500); // This is the duration the welcome message is visible before hiding

    // Hide the loading screen when A-Frame scene is loaded
    const loadingScreenHideTimeout = setTimeout(() => {
        hideElement(loadingScreen);
        // Attempt to play audio after loading screen is hidden
        if (museumAudioElement && museumAudioElement.paused) {
            museumAudioElement.play().catch(e => console.error("Autoplay failed on loading screen hide:", e));
        }
    }, 2000); // Fallback for loading screen: hide after 2 seconds

    sceneEl.addEventListener('loaded', () => {
      clearTimeout(loadingScreenHideTimeout); // Clear fallback if loaded
      hideElement(loadingScreen); // Hide the loading screen
      console.log('A-Frame scene loaded, clearing loading screen timeout.');

      // Attempt to play audio after scene loads (more reliable for some browsers)
      if (museumAudioElement && museumAudioElement.paused) {
          museumAudioElement.play().catch(e => console.error("Autoplay failed on scene loaded:", e));
      }
    }, { once: true });

    // Event listeners for the help modal
    helpButton.addEventListener('click', () => {
        showElement(helpModal);
        // Optional: Pause audio while help modal is open
        if (museumAudioElement && !museumAudioElement.paused) {
            museumAudioElement.pause();
        }
    });

    closeHelpButton.addEventListener('click', () => {
        // Use hideElement with a slight delay to allow transition, then remove 'visible' class
        helpModal.classList.remove('visible');
        helpModal.classList.add('hidden');
        helpModal.addEventListener('transitionend', () => {
          helpModal.style.display = 'none';
          helpModal.classList.remove('hidden'); // Clean up hidden class for next show
        }, { once: true });

        // Resume audio when help modal closes (this is a direct user interaction)
        if (museumAudioElement && museumAudioElement.paused) {
            museumAudioElement.play().catch(e => console.error("Autoplay failed on help modal close:", e));
        }
    });

    // Stop audio after 7 minutes
    // Convert 7 minutes to milliseconds (7 * 60 * 1000)
    const audioDurationMs = 7 * 60 * 1000;

    // We'll set a timeout to stop the audio a bit after it's most likely to have started playing.
    // A good place is after the 'loaded' event of the scene, as that signifies the AR experience is ready.
    sceneEl.addEventListener('loaded', () => {
        // ... (existing code to hide loading screen and try to play audio) ...

        // Set the timeout to stop the audio after 7 minutes
        setTimeout(() => {
            if (museumAudioElement && !museumAudioElement.paused) {
                museumAudioElement.pause();
                museumAudioElement.currentTime = 0; // Optional: reset playback to the beginning
                console.log("Museum audio stopped after 7 minutes.");
            }
        }, audioDurationMs); // 7 minutes in milliseconds
    }, { once: true }); // Ensure this 'loaded' event listener only fires once

    // Renderer settings
    if (sceneEl.renderer) {
      sceneEl.renderer.setPixelRatio(window.devicePixelRatio || 1);
      sceneEl.renderer.sortObjects = false;
    }

    // Debugging console logs for target events
    sceneEl.addEventListener('targetFound', e => console.log('✅ Target found:', e.detail.targetIndex));
    sceneEl.addEventListener('targetLost', e => console.log('❌ Target lost:', e.detail.targetIndex));
  </script>
</body>
</html>
